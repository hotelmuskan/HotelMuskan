<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hotel Muskan | Billing System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #1a1a1a; color: #e5e5e5; -webkit-tap-highlight-color: transparent; }
        .gold-text { color: #D4AF37; }
        .border-gold { border-color: #D4AF37; }
        .bg-gold { background-color: #D4AF37; color: black; }
        .bg-gold:hover { background-color: #b38728; }
        
        /* Custom Scrollbar for a clean look */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #0F0F0F; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        /* Mobile specific adjustments */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; overflow-y: auto !important; height: auto !important; }
            .menu-section { height: 60vh; border-right: none; border-bottom: 2px solid #333; }
            .bill-section { min-height: 40vh; }
            .menu-grid { grid-template-cols: repeat(2, 1fr); }
        }

        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; color: black; background: white; padding: 0; margin: 0; }
            .no-print { display: none; }
            #qr-modal, #dashboard-modal { display: none !important; }
        }

        .modal { transition: opacity 0.3s ease; opacity: 0; pointer-events: none; }
        .modal.open { opacity: 1; pointer-events: auto; }
        
        /* Prevent elastic scrolling on iOS */
        html, body { position: relative; overflow-x: hidden; }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden main-container">

    <!-- Section 1: Menu Selection -->
    <div class="w-full md:w-3/5 flex flex-col h-full border-r border-neutral-800 menu-section">
        <!-- Header -->
        <div class="p-3 border-b border-neutral-800 bg-[#0F0F0F] flex flex-col gap-2">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-lg font-bold gold-text uppercase tracking-tight">Hotel Muskan</h1>
                    <p class="text-[10px] text-neutral-500 uppercase">Mobile Counter</p>
                </div>
                <button onclick="toggleDashboard()" class="text-[10px] bg-neutral-800 text-neutral-300 px-3 py-1.5 rounded border border-neutral-700">
                    <i class="fa-solid fa-chart-line mr-1"></i> Sales
                </button>
            </div>
            <div class="relative w-full">
                <input type="text" id="search-input" placeholder="Search menu items..." 
                    class="bg-neutral-800 border border-neutral-700 rounded-lg py-2 px-4 text-sm focus:outline-none focus:border-[#D4AF37] w-full">
                <i class="fa-solid fa-search absolute right-3 top-3 text-neutral-500 text-xs"></i>
            </div>
        </div>

        <!-- Categories (Scrollable) -->
        <div class="flex overflow-x-auto p-2 bg-[#141414] border-b border-neutral-800 space-x-2 no-scrollbar whitespace-nowrap" id="category-container">
            <button onclick="filterCategory('All')" class="px-4 py-1.5 text-xs rounded-full bg-[#D4AF37] text-black font-semibold">All</button>
            <button onclick="filterCategory('Paneer')" class="px-4 py-1.5 text-xs rounded-full bg-neutral-800">Paneer</button>
            <button onclick="filterCategory('Non-Veg')" class="px-4 py-1.5 text-xs rounded-full bg-neutral-800">Non-Veg</button>
            <button onclick="filterCategory('Rice')" class="px-4 py-1.5 text-xs rounded-full bg-neutral-800">Rice</button>
            <button onclick="filterCategory('Breads')" class="px-4 py-1.5 text-xs rounded-full bg-neutral-800">Breads</button>
            <button onclick="filterCategory('Extras')" class="px-4 py-1.5 text-xs rounded-full bg-neutral-800">Extras</button>
        </div>

        <!-- Menu Grid -->
        <div class="flex-grow overflow-y-auto p-3 bg-[#1a1a1a]">
            <div class="grid grid-cols-2 lg:grid-cols-3 gap-2" id="menu-grid">
                <!-- Items injected by JS -->
            </div>
        </div>
    </div>

    <!-- Section 2: Current Bill -->
    <div class="w-full md:w-2/5 flex flex-col h-full bg-[#0F0F0F] bill-section">
        <div class="p-3 border-b border-neutral-800 flex justify-between items-center bg-[#141414]">
            <h2 class="font-semibold text-sm">Cart Items</h2>
            <div class="text-[10px] text-neutral-500" id="current-date"></div>
        </div>

        <!-- Order Items Table -->
        <div class="flex-grow overflow-y-auto p-2">
            <table class="w-full text-left text-xs">
                <thead class="text-neutral-500 text-[10px] uppercase border-b border-neutral-800">
                    <tr>
                        <th class="pb-2 pl-1">Item</th>
                        <th class="pb-2 text-center w-12">Qty</th>
                        <th class="pb-2 text-right">Total</th>
                        <th class="pb-2 w-6"></th>
                    </tr>
                </thead>
                <tbody id="bill-items-container">
                    <!-- Bill items injected here -->
                </tbody>
            </table>
        </div>

        <!-- Customer Inputs -->
        <div class="px-3 py-2 border-t border-neutral-800 bg-[#141414] grid grid-cols-2 gap-2">
             <input type="text" id="customer-name" placeholder="Guest Name" class="col-span-2 bg-neutral-800 border border-neutral-700 rounded p-2 text-xs focus:border-[#D4AF37] outline-none">
             <input type="tel" id="customer-phone" placeholder="WhatsApp Number" class="bg-neutral-800 border border-neutral-700 rounded p-2 text-xs focus:border-[#D4AF37] outline-none">
             <input type="text" id="table-no" placeholder="Table #" class="bg-neutral-800 border border-neutral-700 rounded p-2 text-xs text-center focus:border-[#D4AF37] outline-none">
             <select id="payment-mode" class="col-span-2 bg-neutral-800 border border-neutral-700 rounded p-2 text-xs text-gray-400 outline-none">
                <option value="Cash">Cash Payment</option>
                <option value="UPI">UPI / Online</option>
                <option value="Card">Card Swipe</option>
             </select>
        </div>

        <!-- Totals & Actions -->
        <div class="p-3 bg-[#1a1a1a] border-t border-neutral-800">
            <div class="space-y-1 mb-3">
                <div class="flex justify-between text-xs text-neutral-400">
                    <span>Subtotal</span> <span id="subtotal-display">₹ 0.00</span>
                </div>
                <div class="flex justify-between items-center text-xs text-neutral-400">
                    <span>Discount (%)</span>
                    <input type="number" id="discount-input" value="0" min="0" max="100" class="w-12 bg-neutral-800 border border-neutral-700 rounded text-right px-1 text-xs text-[#D4AF37]" oninput="renderBill()">
                </div>
                <div class="flex justify-between items-center text-xs text-neutral-400">
                    <span>GST (5%)</span>
                    <input type="checkbox" id="gst-toggle" checked onchange="renderBill()" class="accent-[#D4AF37] w-4 h-4">
                </div>
                <div class="flex justify-between text-lg font-bold text-[#D4AF37] border-t border-dashed border-neutral-700 pt-2 mt-2">
                    <span>Total</span> <span id="total-display">₹ 0.00</span>
                </div>
            </div>

            <!-- Mobile Action Grid -->
            <div class="grid grid-cols-2 gap-2">
                <button onclick="clearBill()" class="py-2.5 rounded bg-red-900/20 text-red-500 border border-red-900 text-[10px] font-bold uppercase">
                    <i class="fa-solid fa-trash mr-1"></i> Clear
                </button>
                <button onclick="showQRModal()" class="py-2.5 rounded bg-blue-600 text-white text-[10px] font-bold uppercase">
                    <i class="fa-solid fa-qrcode mr-1"></i> Pay QR
                </button>
                <button onclick="sendWhatsApp()" class="py-2.5 rounded bg-green-600 text-white text-[10px] font-bold uppercase">
                    <i class="fa-brands fa-whatsapp mr-1"></i> WhatsApp
                </button>
                <button onclick="generateReceipt()" class="py-2.5 rounded bg-[#D4AF37] text-black text-[10px] font-bold uppercase">
                    <i class="fa-solid fa-print mr-1"></i> Print Bill
                </button>
            </div>
        </div>
    </div>

    <!-- Modals & Templates (Same as before) -->
    <div id="qr-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4">
        <div class="bg-[#1a1a1a] border border-[#D4AF37] rounded-xl p-5 w-full max-w-xs text-center">
            <h3 class="text-[#D4AF37] font-bold mb-2">Scan to Pay</h3>
            <div class="bg-white p-2 rounded-lg inline-block mb-3">
                <img id="qr-image" src="" alt="QR" class="w-40 h-40">
            </div>
            <div class="text-xl font-bold mb-4" id="qr-amount">₹ 0.00</div>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="closeQRModal()" class="py-2 rounded bg-neutral-700 text-xs">Cancel</button>
                <button onclick="recordSale('UPI'); closeQRModal()" class="py-2 rounded bg-green-600 text-white text-xs">Received</button>
            </div>
        </div>
    </div>

    <div id="dashboard-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4">
        <div class="bg-[#1a1a1a] border border-neutral-700 rounded-lg w-full max-w-md h-[80vh] flex flex-col">
            <div class="p-4 border-b border-neutral-700 flex justify-between items-center">
                <h2 class="text-[#D4AF37] font-bold">Sales Dashboard</h2>
                <button onclick="toggleDashboard()"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="p-4 overflow-y-auto">
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <div class="bg-neutral-800 p-3 rounded"><p class="text-[10px] text-neutral-400">TOTAL</p><p class="font-bold" id="dash-total">₹ 0</p></div>
                    <div class="bg-neutral-800 p-3 rounded"><p class="text-[10px] text-neutral-400">ORDERS</p><p class="font-bold" id="dash-count">0</p></div>
                </div>
                <h3 class="text-xs font-bold mb-2">Recent Orders</h3>
                <div id="dash-history" class="space-y-2 text-xs"></div>
            </div>
        </div>
    </div>

    <div id="receipt-area" class="hidden font-mono text-xs p-4">
        <div class="text-center mb-2">
            <h2 class="text-lg font-bold">HOTEL MUSKAN</h2>
            <p>BHAGWANPUR, Bihar | +91 96086 35670</p>
        </div>
        <div class="border-b border-black mb-2 py-1 flex justify-between">
            <span id="print-date"></span><span id="print-table"></span>
        </div>
        <table class="w-full mb-2">
            <tbody id="print-items"></tbody>
        </table>
        <div class="border-t border-black pt-1 font-bold flex justify-between">
            <span>TOTAL:</span><span id="print-total"></span>
        </div>
        <p class="text-center mt-4">Thank you! Visit again.</p>
    </div>

    <script>
        const UPI_ID = "ajaykumar2569563@ybl";
        const RESTAURANT_NAME = "Hotel Muskan";

        const menuItems = [
            { id: 1, name: "Shahi Paneer (Full)", price: 260, category: "Paneer" },
            { id: 2, name: "Shahi Paneer (Half)", price: 130, category: "Paneer" },
            { id: 3, name: "Mattar Paneer (Full)", price: 220, category: "Paneer" },
            { id: 4, name: "Mattar Paneer (Half)", price: 110, category: "Paneer" },
            { id: 5, name: "Paneer Do Pyaza (Full)", price: 240, category: "Paneer" },
            { id: 6, name: "Paneer Do Pyaza (Half)", price: 120, category: "Paneer" },
            { id: 7, name: "Paneer Masala (Full)", price: 240, category: "Paneer" },
            { id: 8, name: "Paneer Masala (Half)", price: 120, category: "Paneer" },
            { id: 9, name: "Paneer Chilli (Full)", price: 240, category: "Paneer" },
            { id: 10, name: "Paneer Chilli (Half)", price: 120, category: "Paneer" },
            { id: 11, name: "Palak Paneer (Full)", price: 180, category: "Paneer" },
            { id: 12, name: "Palak Paneer (Half)", price: 90, category: "Paneer" },
            { id: 13, name: "Chicken Do Pyaza (Full)", price: 260, category: "Non-Veg" },
            { id: 14, name: "Chicken Do Pyaza (Half)", price: 130, category: "Non-Veg" },
            { id: 15, name: "Chicken Curry (Full)", price: 180, category: "Non-Veg" },
            { id: 16, name: "Chicken Curry (Half)", price: 90, category: "Non-Veg" },
            { id: 17, name: "Chicken chilli (Full)", price: 240, category: "Non-Veg" },
            { id: 18, name: "Chicken Chilli (Half)", price: 120, category: "Non-Veg" },
            { id: 19, name: "Fish Curry (Full)", price: 160, category: "Non-Veg" },
            { id: 20, name: "Fish Curry (Half)", price: 80, category: "Non-Veg" },
            { id: 21, name: "Egg Curry (Full)", price: 120, category: "Non-Veg" },
            { id: 22, name: "Egg Curry (Half)", price: 60, category: "Non-Veg" },
            { id: 23, name: "Omelette Curry (Full)", price: 160, category: "Non-Veg" },
            { id: 24, name: "Omelette Curry (Half)", price: 80, category: "Non-Veg" },
            { id: 25, name: "Plain Rice (Full)", price: 70, category: "Rice" },
            { id: 26, name: "Plain Rice (Half)", price: 40, category: "Rice" },
            { id: 27, name: "Jeera Rice (Full)", price: 80, category: "Rice" },
            { id: 28, name: "Jeera Rice (Half)", price: 40, category: "Rice" },
            { id: 29, name: "Plain Roti", price: 6, category: "Breads" },
            { id: 30, name: "Butter Roti", price: 12, category: "Breads" },
            { id: 31, name: "Special Tea", price: 10, category: "Extras" },
            { id: 32, name: "Mineral Water", price: 20, category: "Extras" },
            { id: 33, name: "Cold Drink", price: 40, category: "Extras" }
        ];

        let currentBill = [];
        let salesData = { total: 0, count: 0, cash: 0, online: 0, history: [] };

        window.onload = function() {
            renderMenu('All');
            updateDate();
            document.getElementById('search-input').addEventListener('input', (e) => searchMenu(e.target.value));
        };

        function updateDate() {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function renderMenu(category) {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            const items = category === 'All' ? menuItems : menuItems.filter(i => i.category === category);
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = `p-2 rounded border border-neutral-700 bg-[#252525] active:border-[#D4AF37] transition-all flex flex-col justify-between h-20`;
                div.onclick = () => addToBill(item);
                let iconColor = item.category === 'Non-Veg' ? 'text-red-500' : (item.category === 'Extras' ? 'text-blue-400' : 'text-green-500');
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="text-[10px] font-semibold leading-tight line-clamp-2">${item.name}</span>
                        <i class="fa-solid fa-circle text-[6px] ${iconColor}"></i>
                    </div>
                    <div class="flex justify-between items-end">
                        <span class="text-[#D4AF37] font-bold text-xs">₹${item.price}</span>
                        <span class="text-[8px] text-neutral-500 bg-black px-1 rounded">+</span>
                    </div>
                `;
                grid.appendChild(div);
            });
            const buttons = document.getElementById('category-container').getElementsByTagName('button');
            for(let btn of buttons) {
                btn.className = btn.innerText === category ? "px-4 py-1.5 text-xs rounded-full bg-[#D4AF37] text-black font-semibold" : "px-4 py-1.5 text-xs rounded-full bg-neutral-800";
            }
        }

        function filterCategory(cat) { renderMenu(cat); }

        function searchMenu(query) {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = '';
            const items = menuItems.filter(i => i.name.toLowerCase().includes(query.toLowerCase()));
            if(!items.length) { grid.innerHTML = '<div class="col-span-2 text-center text-neutral-500 text-xs py-4">No items</div>'; return; }
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = `p-2 rounded border border-neutral-700 bg-[#252525] active:border-[#D4AF37] flex flex-col justify-between h-20`;
                div.onclick = () => addToBill(item);
                div.innerHTML = `<span class="text-[10px] font-semibold">${item.name}</span><span class="text-[#D4AF37] font-bold text-xs">₹${item.price}</span>`;
                grid.appendChild(div);
            });
        }

        function addToBill(item) {
            const existing = currentBill.find(i => i.id === item.id);
            if (existing) existing.qty++; else currentBill.push({ ...item, qty: 1 });
            renderBill();
            if(navigator.vibrate) navigator.vibrate(50); // Haptic feedback
        }

        function updateQty(id, change) {
            const item = currentBill.find(i => i.id === id);
            if (item) {
                item.qty += change;
                if (item.qty <= 0) currentBill = currentBill.filter(i => i.id !== id);
            }
            renderBill();
        }

        function removeItem(id) { currentBill = currentBill.filter(i => i.id !== id); renderBill(); }

        function calculateBillTotal() {
            let subtotal = 0;
            currentBill.forEach(item => subtotal += item.price * item.qty);
            const discPer = parseFloat(document.getElementById('discount-input').value) || 0;
            const discAmt = (subtotal * discPer) / 100;
            const discSub = subtotal - discAmt;
            const gst = document.getElementById('gst-toggle').checked ? discSub * 0.05 : 0;
            return { subtotal, discAmt, gst, total: discSub + gst };
        }

        function renderBill() {
            const container = document.getElementById('bill-items-container');
            container.innerHTML = '';
            const totals = calculateBillTotal();
            currentBill.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-neutral-800";
                tr.innerHTML = `
                    <td class="py-3 pl-1 font-medium text-neutral-300 text-[10px] truncate max-w-[100px]">${item.name}</td>
                    <td class="py-3"><div class="flex items-center justify-center bg-neutral-900 rounded border border-neutral-700 w-14 mx-auto">
                        <button onclick="updateQty(${item.id}, -1)" class="px-2 text-neutral-400">-</button>
                        <span class="text-[10px] w-4 text-center">${item.qty}</span>
                        <button onclick="updateQty(${item.id}, 1)" class="px-2 text-neutral-400">+</button>
                    </div></td>
                    <td class="py-3 text-right font-medium text-[10px]">₹${item.price * item.qty}</td>
                    <td class="py-3 text-center"><button onclick="removeItem(${item.id})" class="text-red-500/50"><i class="fa-solid fa-times"></i></button></td>
                `;
                container.appendChild(tr);
            });
            document.getElementById('subtotal-display').innerText = `₹ ${totals.subtotal.toFixed(2)}`;
            document.getElementById('total-display').innerText = `₹ ${totals.total.toFixed(2)}`;
        }

        function clearBill() { if(confirm("Clear current order?")) { currentBill = []; renderBill(); } }

        function recordSale(modeOverride = null) {
            if (!currentBill.length) return;
            const totals = calculateBillTotal();
            const mode = modeOverride || document.getElementById('payment-mode').value;
            salesData.total += totals.total;
            salesData.count++;
            salesData.history.unshift({ time: new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}), amount: totals.total, mode });
            updateDashboardUI();
        }

        function updateDashboardUI() {
            document.getElementById('dash-total').innerText = `₹ ${salesData.total.toFixed(2)}`;
            document.getElementById('dash-count').innerText = salesData.count;
            const tbody = document.getElementById('dash-history');
            tbody.innerHTML = salesData.history.map(h => `<div class="flex justify-between p-2 bg-neutral-800 rounded"><span>${h.time}</span><span>${h.mode}</span><span class="gold-text">₹${h.amount.toFixed(2)}</span></div>`).join('');
        }

        function toggleDashboard() { document.getElementById('dashboard-modal').classList.toggle('open'); }

        function showQRModal() {
            if (!currentBill.length) return;
            const totals = calculateBillTotal();
            const amount = totals.total.toFixed(2);
            const upiString = `upi://pay?pa=${UPI_ID}&pn=${encodeURIComponent(RESTAURANT_NAME)}&am=${amount}&cu=INR`;
            document.getElementById('qr-image').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiString)}`;
            document.getElementById('qr-amount').innerText = `₹ ${amount}`;
            document.getElementById('qr-modal').classList.add('open');
        }

        function closeQRModal() { document.getElementById('qr-modal').classList.remove('open'); }

        function generateReceipt() {
            if (!currentBill.length) return;
            recordSale();
            const now = new Date();
            document.getElementById('print-date').innerText = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
            document.getElementById('print-table').innerText = "Table: " + (document.getElementById('table-no').value || "NA");
            const tbody = document.getElementById('print-items');
            tbody.innerHTML = currentBill.map(i => `<tr><td>${i.name}</td><td class="text-center">x${i.qty}</td><td class="text-right">₹${i.price*i.qty}</td></tr>`).join('');
            document.getElementById('print-total').innerText = document.getElementById('total-display').innerText;
            const target = document.getElementById('receipt-area');
            target.classList.add('print-area');
            window.print();
            target.classList.remove('print-area');
        }

        function sendWhatsApp() {
            if (!currentBill.length) return;
            const phone = document.getElementById('customer-phone').value;
            const totals = calculateBillTotal();
            let msg = `*HOTEL MUSKAN BILL*%0a`;
            currentBill.forEach(i => msg += `${i.name} x${i.qty} = ₹${i.price*i.qty}%0a`);
            msg += `*Total: ₹${totals.total.toFixed(2)}*%0aThank you!`;
            window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
            recordSale();
        }

        setInterval(updateDate, 30000);
    </script>
</body>
</html>

